# /Users/user/Desktop/Core Guild Project/projects/colabs/eng-teams/core/personal-website/prototype/.github/workflows/deploy-hotfix.yml
# Professional FTP deployment workflow using industry best practices
name: ğŸš‘ Hotfix Deploy

on:
  workflow_dispatch:
    inputs:
      deployment_method:
        description: 'Choose deployment method'
        required: true
        default: 'industry-standard'
        type: choice
        options:
        - industry-standard
        - debug-deployment
        - manual-debug

jobs:
  deploy-hotfix:
    name: ğŸš‘ Emergency Deploy
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‹ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ğŸ“š Install dependencies
        run: npm ci
        
      - name: ğŸ—ï¸ Build application
        run: npm run build
        
      - name: ğŸ“ Prepare deployment directory
        run: |
          mkdir -p deployment
          cp -r out/* deployment/
          echo "ğŸ“ Deployment files prepared:"
          ls -la deployment/
          echo "ğŸ“Š Total files to deploy:"
          find deployment/ -type f | wc -l
          
      - name: ğŸ§¹ Industry Standard Deployment (Recommended)
        if: ${{ github.event.inputs.deployment_method == 'industry-standard' }}
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: files.hostinger.com
          username: ${{ secrets.HOSTINGER_FTP_USERNAME }}
          password: ${{ secrets.HOSTINGER_FTP_PASSWORD }}
          local-dir: ./deployment/
          server-dir: ./public_html/
          protocol: ftp
          port: 21
          log-level: verbose
          dangerous-clean-slate: true
          timeout: 60000
          security: loose
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/.DS_Store
            **/Thumbs.db
          
      - name: ğŸ”§ Debug Deployment with Extensive Logging
        if: ${{ github.event.inputs.deployment_method == 'debug-deployment' }}
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: files.hostinger.com
          username: ${{ secrets.HOSTINGER_FTP_USERNAME }}
          password: ${{ secrets.HOSTINGER_FTP_PASSWORD }}
          local-dir: ./deployment/
          server-dir: ./public_html/
          protocol: ftp
          port: 21
          log-level: verbose
          dangerous-clean-slate: true
          timeout: 120000
          security: loose
          dry-run: false
          
      - name: â³ Wait for file propagation
        if: ${{ github.event.inputs.deployment_method != 'manual-debug' }}
        run: |
          echo "â³ Waiting 60 seconds for file propagation..."
          sleep 60
          
      - name: ğŸ§ª Professional Verification
        if: ${{ github.event.inputs.deployment_method != 'manual-debug' }}
        run: |
          echo "ğŸ” Professional deployment verification..."
          
          # Test 1: Basic connectivity
          echo "ğŸ“¡ Test 1: Website accessibility"
          if curl -I https://caiocastilho.com --connect-timeout 15 -w "%{http_code}" | grep -q "200"; then
            echo "âœ… Website is accessible (HTTP 200)"
          else
            echo "âš ï¸ Website returned non-200 status"
          fi
          
          # Test 2: Content verification
          echo "ğŸ” Test 2: Content verification"
          CONTENT=$(curl -s https://caiocastilho.com --connect-timeout 15)
          
          if echo "$CONTENT" | grep -q "Caio A. S. Castilho"; then
            echo "âœ… SUCCESS: Our professional content is LIVE!"
            echo "ğŸ‰ Website deployed successfully!"
            echo "ğŸŒ Access: https://caiocastilho.com"
          elif echo "$CONTENT" | grep -q "EstÃ¡ tudo pronto"; then
            echo "âŒ ISSUE: Default Hostinger page still showing"
            echo "ğŸ”„ Files were uploaded but may not have replaced existing content"
            echo "ğŸ“ Manual verification needed in hPanel File Manager"
          else
            echo "âš ï¸ Unexpected content or connection issue"
            echo "ğŸ“„ Content preview:"
            echo "$CONTENT" | head -10
          fi
          
          # Test 3: Technical verification
          echo "ğŸ“„ Test 3: Technical structure"
          if echo "$CONTENT" | grep -q "Mechatronic Engineer"; then
            echo "âœ… Professional title found"
          fi
          
          if echo "$CONTENT" | grep -q "github.com/Caioasc"; then
            echo "âœ… Social links working"
          fi
          
          if echo "$CONTENT" | grep -q "_next/static"; then
            echo "âœ… Next.js static assets detected"
          fi
          
      - name: ğŸ” Manual Debug Information
        if: ${{ github.event.inputs.deployment_method == 'manual-debug' }}
        run: |
          echo "ğŸ” Manual Debug Information"
          echo "========================="
          echo "ğŸŒ Domain: caiocastilho.com"
          echo "ğŸ“ FTP Server: files.hostinger.com"
          echo "ğŸ‘¤ Username: u300282944"
          echo "ğŸ“‚ Target Directory: public_html"
          echo "ğŸ”‘ Password: Check GitHub Secrets"
          echo ""
          echo "ğŸ§ª Testing connectivity:"
          ping -c 3 files.hostinger.com || echo "âŒ Server not reachable"
          echo ""
          echo "ğŸ“ Recommended manual steps:"
          echo "1. Login to hPanel File Manager"
          echo "2. Navigate to public_html directory"
          echo "3. Delete ALL existing files"
          echo "4. Upload files from 'out' directory"
          echo "5. Verify index.html is in root of public_html"
          
      - name: ğŸ“Š Deployment Summary
        if: always()
        run: |
          echo "ğŸ“Š DEPLOYMENT SUMMARY"
          echo "===================="
          echo "ğŸŒ Domain: caiocastilho.com"
          echo "ğŸ“¦ Files deployed: $(find deployment/ -type f | wc -l)"
          echo "ğŸ’¾ Package size: $(du -sh deployment/ | cut -f1)"
          echo "â° Deployment time: $(date -u)"
          echo "ğŸ¯ Method: ${{ github.event.inputs.deployment_method }}"
          echo ""
          echo "ğŸ”— Next steps:"
          echo "- Access: https://caiocastilho.com"
          echo "- Verify all pages work"
          echo "- Test mobile responsiveness"
          echo "- Check social media links" 