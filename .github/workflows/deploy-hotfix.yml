# /Users/user/Desktop/Core Guild Project/projects/colabs/eng-teams/core/personal-website/prototype/.github/workflows/deploy-hotfix.yml
# Hotfix deployment workflow with multiple deployment methods
name: 🚑 Hotfix Deploy

on:
  workflow_dispatch:
    inputs:
      deployment_method:
        description: 'Choose deployment method'
        required: true
        default: 'ftp-primary'
        type: choice
        options:
        - ftp-primary
        - ftp-alternative
        - manual-debug

jobs:
  deploy-hotfix:
    name: 🚑 Emergency Deploy
    runs-on: ubuntu-latest
    
    steps:
      - name: 📋 Checkout code
        uses: actions/checkout@v4
        
      - name: 📦 Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: 📚 Install dependencies
        run: npm ci
        
      - name: 🏗️ Build application
        run: npm run build
        
      - name: 📁 Prepare deployment directory
        run: |
          mkdir -p deployment
          cp -r out/* deployment/
          
      - name: 🚀 Deploy via Primary FTP
        if: ${{ github.event.inputs.deployment_method == 'ftp-primary' }}
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.HOSTINGER_FTP_SERVER }}
          username: ${{ secrets.HOSTINGER_FTP_USERNAME }}
          password: ${{ secrets.HOSTINGER_FTP_PASSWORD }}
          local-dir: ./deployment/
          server-dir: ./public_html/
          protocol: ftp
          port: 21
          
      - name: 🚀 Deploy via Alternative FTP
        if: ${{ github.event.inputs.deployment_method == 'ftp-alternative' }}
        uses: sebastianpopp/ftp-action@releases/v2
        with:
          host: ${{ secrets.HOSTINGER_FTP_SERVER }}
          user: ${{ secrets.HOSTINGER_FTP_USERNAME }}
          password: ${{ secrets.HOSTINGER_FTP_PASSWORD }}
          localDir: "./deployment/"
          remoteDir: "./public_html/"
          
      - name: 🔍 Debug Connection Info
        if: ${{ github.event.inputs.deployment_method == 'manual-debug' }}
        run: |
          echo "🔍 Testing connection parameters..."
          echo "Server masked"
          echo "Username format test"
          ping -c 3 ${{ secrets.HOSTINGER_FTP_SERVER }} || echo "Ping failed" 